<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=1656684ee74e88bdaae2079875834daca9122a48">


    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true
      }
    });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>OCaml + Cordova = more secured, typed and hybrid mobile applications. | Random notes</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="OCaml + Cordova = more secured, typed and hybrid mobile applications." />
<meta name="author" content="Danny Willems" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Since several months, I began to be interested in mobile development. I found a job in Brussels in July 2015 where I learned how to develop hybrid mobile applications (one code = available for multiple mobile platforms) with Cordova and web technologies. I found it very interesting and after several month I continue to develop applications with this technology. I discovered a very great community about mobile development and some awesome frameworks like Ionic." />
<meta property="og:description" content="Since several months, I began to be interested in mobile development. I found a job in Brussels in July 2015 where I learned how to develop hybrid mobile applications (one code = available for multiple mobile platforms) with Cordova and web technologies. I found it very interesting and after several month I continue to develop applications with this technology. I discovered a very great community about mobile development and some awesome frameworks like Ionic." />
<link rel="canonical" href="http://localhost:4000/2016/07/14/ocaml-cordova-secured-typed-hybrid-mobile-applications.html" />
<meta property="og:url" content="http://localhost:4000/2016/07/14/ocaml-cordova-secured-typed-hybrid-mobile-applications.html" />
<meta property="og:site_name" content="Random notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-07-14T00:00:00+00:00" />
<script type="application/ld+json">
{"description":"Since several months, I began to be interested in mobile development. I found a job in Brussels in July 2015 where I learned how to develop hybrid mobile applications (one code = available for multiple mobile platforms) with Cordova and web technologies. I found it very interesting and after several month I continue to develop applications with this technology. I discovered a very great community about mobile development and some awesome frameworks like Ionic.","author":{"@type":"Person","name":"Danny Willems"},"@type":"BlogPosting","url":"http://localhost:4000/2016/07/14/ocaml-cordova-secured-typed-hybrid-mobile-applications.html","headline":"OCaml + Cordova = more secured, typed and hybrid mobile applications.","dateModified":"2016-07-14T00:00:00+00:00","datePublished":"2016-07-14T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2016/07/14/ocaml-cordova-secured-typed-hybrid-mobile-applications.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <h1>Random notes</h1>
        <h2>Random notes on FP, blockchain/DLT, crypto currency, cryptography, (computational) algebra, (computational) number theory, logic, type system, maybe quantum computing</h2>

        <section id="downloads">
          
          <a href="https://github.com/dannywillems/dannywillems.github.io" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <small>14 July 2016</small>
<h1>OCaml + Cordova = more secured, typed and hybrid mobile applications.
</h1>

<p class="view">by Danny Willems</p>

<p>Since several months, I began to be interested in mobile development. I found a job in Brussels in July 2015 where I learned how to develop hybrid mobile applications (one code = available for multiple mobile platforms) with Cordova and web technologies. I found it very interesting and after several month I continue to develop applications with this technology. I discovered a very great community about mobile development and some awesome frameworks like <a href="http://ionicframework.com/">Ionic</a>.</p>

<p>The majority of these frameworks use JavaScript as programming language but I don’t really like this language because you have no types, some weird things (equality between string and integer), parameters are sent as undefined if not passed, etc. I don’t really like to develop applications with JavaScript because it’s very ugly (even if I think it’s OK for prototyping, but not in production).</p>

<p>I discovered OCaml at the university, a very powerful programming language with inferred static type, type checking at compilation time, an extraordinary community and… a compiler from OCaml to JavaScript! So, I wanted to use this language to develop mobile applications with Cordova: it will be my university project for a semester.</p>
<p class="dw-quote">The goal of my project is to be able to use native components of smartphones such like accelerometer, camera, send sms, etc in OCaml.</p>

<h2 id="what-are-cordova-js_of_ocaml-and-gen_js_api">What are Cordova, js_of_ocaml and gen_js_api?</h2>

<ul>
  <li><a href="https://cordova.apache.org/">Cordova</a> allows you to develop hybrid mobile applications using web technologies such as HTML, CSS and JavaScript. For more information, see <a href="https://cordova.apache.org/">the official website</a>. Through Cordova plugins, you can access to the native components. To learn how to make Cordova plugins, see <a href="https://cordova.apache.org/docs/en/latest/guide/hybrid/plugins/index.html">the official tutorial</a>. You can find the official Cordova plugin list <a href="https://cordova.apache.org/plugins/">here.</a></li>
  <li><a href="https://ocsigen.org/js_of_ocaml">js_of_ocaml</a> provides a compiler from OCaml to JavaScript. Since Cordova applications use JavaScript, js_of_ocaml provides a way to develop mobile application using OCaml. For more info, see <a href="http://ocsigen.org/">the Ocsigen project</a> which contains js_of_ocaml</li>
  <li><a href="https://github.com/lexifi/gen_js_api">gen_js_api</a> aims at simplifying the creation of OCaml bindings for JavaScript libraries. It must currently be used with the js_of_ocaml compiler, although other ways to run OCaml code “against” JavaScript might be supported later with the same binding definitions (for instance, Bucklescript, or direct embedding of a JS engine in a native OCaml application)</li>
</ul>

<p>All bindings are developed with gen_js_api and aims to be functional, typed and very close to the JavaScript interface.</p>

<h2 id="how-can-i-use-a-binding">How can I use a binding?</h2>

<p><b>Needs compiler &gt;= 4.03.0</b></p>

<p>I created a GitHub listing all bindings: <a href="https://github.com/dannywillems/ocaml-cordova-plugin-list">ocaml-cordova-plugin-list</a>. Each binding is an opam package and so can be installed with opam. It is recommended to add this repository as a remote opam package provider with</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>opam repository add cordova https://github.com/dannywillems/ocaml-cordova-plugin-list.git
</code></pre></div></div>

<p>Each binding can now be installed. For example, the binding to the camera plugin is <b class="helvetica">cordova-plugin-camera</b>. So, if you want to install the camera binding, you need to use</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>opam install cordova-plugin-camera
</code></pre></div></div>

<p>The appropriate opam package is given in the appropriate GitHub repository (list is given <a href="https://github.com/dannywillems/ocaml-cordova-plugin-list">here</a>).</p>

<p>If the plugin needs the binding to the standard js library such as <b class="helvetica">device-motion</b>, you need to pin the <a href="https://github.com/dannywillems/ocaml-js-stdlib">ocaml-js-stdlib</a> first. If the plugin needs it, it is mentioned in the GitHub repository.</p>

<p>If you don’t want to add this repository, you can manually pin each repository.</p>
<h2 id="what-about-documentation-for-each-bindings">What about documentation for each bindings?</h2>
<p>Bindings interface are very close to initial plugins JavaScript interface. For example, for the <b class="helvetica">cordova-plugin-camera</b> allowing you to take a picture through <b class="helvetica">navigator.camera.getPicture</b> JavaScript function, you use <b class="helvetica">Cordova_camera.get_picture</b> OCaml function. The equivalent OCaml code to</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">success_callback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">success</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">error_callback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span><span class="na">quality</span><span class="p">:</span> <span class="mi">25</span><span class="p">;</span> <span class="nl">destinationType</span><span class="p">:</span> <span class="nx">Camera</span><span class="p">.</span><span class="nx">DestinationType</span><span class="p">.</span><span class="nx">DATA_URL</span><span class="p">}</span>

<span class="nb">navigator</span><span class="p">.</span><span class="nx">camera</span><span class="p">.</span><span class="nx">getPicture</span><span class="p">(</span><span class="nx">success_callback</span><span class="p">,</span> <span class="nx">error_callback</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
</code></pre></div></div>

<p>is</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">success_callback</span> <span class="n">success</span> <span class="o">=</span> <span class="nn">Jsoo_lib</span><span class="p">.</span><span class="n">console_log</span> <span class="n">success</span> <span class="k">in</span>

<span class="k">let</span> <span class="n">error_callback</span> <span class="n">error</span> <span class="o">=</span> <span class="nn">Jsoo_lib</span><span class="p">.</span><span class="n">console_log</span> <span class="n">error</span> <span class="k">in</span>

<span class="k">let</span> <span class="n">options</span> <span class="o">=</span>
<span class="nn">Cordova_camera</span><span class="p">.</span><span class="n">create_options</span>
<span class="o">~</span><span class="n">quality</span><span class="o">:</span><span class="mi">25</span>
<span class="o">~</span><span class="n">destination_type</span><span class="o">:</span><span class="nn">Cordova_camera</span><span class="p">.</span><span class="nc">Data_url</span>
<span class="bp">()</span>
<span class="k">in</span>

<span class="nn">Cordova_camera</span><span class="p">.</span><span class="n">get_picture</span> <span class="n">success_callback</span> <span class="n">error_callback</span> <span class="o">~</span><span class="n">opt</span><span class="o">:</span><span class="n">options</span> <span class="bp">()</span>
</code></pre></div></div>

<p>(supposing <b class="helvetica">Jsoo_lib.console_log</b> is the binding to <b class="helvetica">console.log</b> function, see <a href="https://github.com/dannywillems/jsoo-lib">jsoo_lib</a>). Most functions are implemented with optional arguments and these arguments are at the end of the arguments list, so unit is often mandatory.</p>

<p>As the OCaml interface is very close to JavaScript interface, no OCaml documentation is done yet. Feel free to contribute.</p>

<p>Most of bindings have an example application showing you how to use it. Bindings which don’t have example application are not tested. Please give a feedback about it and open issues if it’s the case.</p>

<p class="dw-quote">You can find more information about this project on <a href="https://github.com/dannywillems/ocaml-cordova-plugin-list">ocaml-cordova-plugin-list</a> GitHub repository.</p>

<h2 id="be-careful-device_ready-event">Be careful: device_ready event</h2>

<p>Most of plugins create new objects which are only available when the <b class="helvetica">deviceready</b> event fires. You need to have as first lines:</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">on_device_ready</span> <span class="bp">()</span> <span class="o">=</span>
<span class="c">(* Your code using plugins here *)</span>

<span class="k">let</span> <span class="n">_</span> <span class="o">=</span> <span class="nn">Cordova</span><span class="p">.</span><span class="nn">Event</span><span class="p">.</span><span class="n">device_ready</span> <span class="n">on_device_ready</span>
</code></pre></div></div>

<p>The module <b class="helvetica">Cordova</b> comes from the binding to the <b class="helvetica">cordova</b> object so you need to add it for each project. This module can be installed with</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>opam install cordova
</code></pre></div></div>

<h2 id="could-you-give-an-entire-example-please">Could you give an entire example please?</h2>

<p>Of course. I will show you how to write a hybrid application allowing you to send a SMS to someone. If we succeed to send the SMS, a dialog appears saying everything is OK, else a dialog shows an error message.
You can find all the code in <a href="https://github.com/dannywillems/ocaml-cordova-plugin-sms-example">this repository</a></p>

<p><a href="http://blog.danny-willems.be/wp-content/uploads/2016/07/Selection_002.png"><img src="http://blog.danny-willems.be/wp-content/uploads/2016/07/Selection_002-170x300.png" alt="ocaml-cordova-plugin-sms-example" width="170" height="300" class="size-medium wp-image-410" /></a></p>

<p>Other examples can be found <a href="https://github.com/dannywillems/ocaml-cordova-plugin-list">here</a>. Here some other screenshots.</p>

<p><a href="http://blog.danny-willems.be/wp-content/uploads/2016/07/screenshot_android.png"><img src="http://blog.danny-willems.be/wp-content/uploads/2016/07/screenshot_android-167x300.png" alt="ocaml-cordova-plugin-toast-example-android" width="167" height="300" class="size-medium wp-image-415" /></a></p>

<p><a href="http://blog.danny-willems.be/wp-content/uploads/2016/07/screenshot_ios.png"><img src="http://blog.danny-willems.be/wp-content/uploads/2016/07/screenshot_ios-166x300.png" alt="ocaml-cordova-plugin-toast-example-ios" width="166" height="300" class="size-medium wp-image-414" /></a></p>

<h3 id="set-up-the-development-environment">Set up the development environment</h3>
<p>First thing to do is to set up the development environment. What we need is:</p>
<ul>
  <li><b class="helvetica">Cordova</b> distributed as a NodeJS package. To install NodeJS, I recommend to use <a href="https://github.com/creationix/nvm">nvm</a>. Read the GitHub instructions to install nvm and a NodeJS version. After that, install globally Cordova with
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install <span class="nt">-g</span> cordova
</code></pre></div>    </div>
  </li>
  <li><b class="helvetica">OCaml 4.03.0 and opam</b>. See <a href="https://ocaml.org">ocaml.org</a> to install OCaml and opam for your distribution. After that, install OCaml 4.03.0 by using
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>opam switch 4.03.0
</code></pre></div>    </div>
  </li>
</ul>

<p>Now we have a basic development environment. We will install all Cordova plugins we need and all opam package (included bindings to Cordova plugins).</p>
<h3 id="create-the-cordova-project-and-install-the-needed-plugins">Create the Cordova project and install the needed plugins</h3>

<p>Create a Cordova project by using</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cordova create ocaml-cordova-plugin-sms-example
</code></pre></div></div>

<p>A basic Cordova project is created in the <b class="helvetica">ocaml-cordova-plugin-sms-example</b> directory. Go in this directory with</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>ocaml-cordova-plugin-sms-example
</code></pre></div></div>

<p>In this directory, you find a <b class="helvetica">www</b> directory which will be included in the final package you will install on the smartphone. It works <b>exactly</b> like a website. It contains a <b class="helvetica">index.html</b> file which is the first executed file (Cordova uses a WebView in which web files are executed, like a standard website).</p>

<p>We have to add the platform we need to build for. If you want to build for iOS (you need Mac OS X with XCode installed), use</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cordova platform add ios
</code></pre></div></div>

<p>If you want to build for Android, you need to install <a href="https://developer.android.com/studio/index.html">the Android SDK</a>. See <a href="https://cordova.apache.org/docs/fr/latest/guide/platforms/android/">the official documentation</a> for the entire installation process. To add the Android platform to the Cordova project, use</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cordova platform add android
</code></pre></div></div>

<p class="dw-quote">I don't give the example for Windows/Windows Phone because it's very hard to install natively OCaml on Windows and you need to be on Windows to build for Windows/Windows Phone. However, with <a href="http://www.howtogeek.com/249966/how-to-install-and-use-the-linux-bash-shell-on-windows-10/">Bash on Windows</a> eveything is working like on a common Linux Distrbution.</p>
<p>Now we install plugins. For this example, we will used two plugins: <a href="https://github.com/cordova-sms/cordova-sms-plugin">cordova-plugin-sms</a> to send the message and <a href="https://github.com/apache/cordova-plugin-dialogs">cordova-plugin-dialogs</a> to show a dialog. We can install with these commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cordova plugin add cordova-plugin-sms
cordova plugin add cordova-plugin-dialogs
</code></pre></div></div>

<h3 id="ocaml-and-opam-packages">OCaml and opam packages</h3>
<p>We need <b class="helvetica">js_of_ocaml</b> (to compile our source file in JavaScript) and <b class="helvetica">gen_js_api</b> (to compile the bindings). We install it with opam with</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>opam install js_of_ocaml gen_js_api
</code></pre></div></div>

<p>After that, we add the opam package provider listing all bindings OCaml to the Cordova plugins available.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>opam repository add cordova https://github.com/dannywillems/ocaml-cordova-plugin-list.git
</code></pre></div></div>

<p>As described in the repository, the bindings to <b class="helvetica">cordova-plugin-sms</b> and <b class="helvetica">cordova-plugin-dialogs</b> are available in the opam package <b class="helvetica">cordova-plugin-sms</b> and <b class="helvetica">cordova-plugin-dialogs</b>. So we use:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>opam install cordova-plugin-sms cordova-plugin-dialogs
</code></pre></div></div>

<p>Due to the <b class="helvetica">deviceready</b> event, we need the binding to the Cordova object (as said in GitHub repository). We install it with</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>opam install cordova
</code></pre></div></div>

<p>I will also use some functions coming from <a href="https://github.com/dannywillems/jsoo-lib">jsoo_lib</a>, a small library I write with bindings to standard JavaScript functions. You need to pin it and install it with opam</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>opam pin add jsoo_lib https://github.com/dannywillems/jsoo-lib.git
</code></pre></div></div>

<p>And now we have finished with the set up development environment. Go into code!</p>
<h3 id="indexhtml-and-design">index.html and design</h3>
<p>We use <a href="http://materializecss.com/">materializecss</a> as a CSS framework. We move in the www directory and we use npm to install it:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>www &amp;amp<span class="p">;</span>&amp;amp<span class="p">;</span> npm install materialize-css
</code></pre></div></div>

<p>For the design, we need two inputs and a button to send the message. We replace the current <b class="helvetica">index.html</b> content with this following:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"Content-Security-Policy"</span> <span class="na">content=</span><span class="s">"default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"format-detection"</span> <span class="na">content=</span><span class="s">"telephone=no"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"msapplication-tap-highlight"</span> <span class="na">content=</span><span class="s">"no"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"css/index.css"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- CSS setup for materialize --&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"node_modules/materialize-css/dist/css/materialize.min.css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"cordova.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"js/main.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;title&gt;</span>OCaml Cordova Plugin: Sms<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"node_modules/jquery/dist/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"node_modules/materialize-css/dist/js/materialize.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"col s12"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"input-field col s12"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"num"</span> <span class="na">type=</span><span class="s">"tel"</span> <span class="na">class=</span><span class="s">"validate"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"num"</span><span class="nt">&gt;</span>Phone number<span class="nt">&lt;/label&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"input-field col s12"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"msg"</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"validate"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"msg"</span><span class="nt">&gt;</span>Your message<span class="nt">&lt;/label&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"input-field col s12 center"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn waves-effect waves-light"</span> <span class="na">id=</span><span class="s">"submit"</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"action"</span><span class="nt">&gt;</span>Send<span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"material-icons right"</span><span class="nt">&gt;</span>send<span class="nt">&lt;/i&gt;&lt;/button&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>To have the Material Icons, we need to write a CSS file. We also add a padding-top. Remove the entire content of <b class="helvetica">css/index.css</b> and insert the following code</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">body</span> <span class="p">{</span>
  <span class="nl">padding-top</span><span class="p">:</span> <span class="m">25px</span><span class="p">;</span>
<span class="p">}</span>


<span class="c">/* fallback */</span>

<span class="k">@font-face</span> <span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Material Icons'</span><span class="p">;</span>
  <span class="nl">font-style</span><span class="p">:</span> <span class="nb">normal</span><span class="p">;</span>
  <span class="nl">font-weight</span><span class="p">:</span> <span class="m">400</span><span class="p">;</span>
  <span class="nl">src</span><span class="p">:</span> <span class="n">local</span><span class="p">(</span><span class="s2">'Material Icons'</span><span class="p">),</span> <span class="n">local</span><span class="p">(</span><span class="s2">'MaterialIcons-Regular'</span><span class="p">),</span> <span class="sx">url(../fonts/material_icons.ttf)</span> <span class="n">format</span><span class="p">(</span><span class="s2">'ttf'</span><span class="p">);</span>
<span class="p">}</span>

<span class="nc">.material-icons</span> <span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Material Icons'</span><span class="p">;</span>
  <span class="nl">font-weight</span><span class="p">:</span> <span class="nb">normal</span><span class="p">;</span>
  <span class="nl">font-style</span><span class="p">:</span> <span class="nb">normal</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">24px</span><span class="p">;</span>
  <span class="nl">line-height</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
  <span class="nl">letter-spacing</span><span class="p">:</span> <span class="nb">normal</span><span class="p">;</span>
  <span class="nl">text-transform</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">inline-block</span><span class="p">;</span>
  <span class="nl">white-space</span><span class="p">:</span> <span class="nb">nowrap</span><span class="p">;</span>
  <span class="nl">word-wrap</span><span class="p">:</span> <span class="nb">normal</span><span class="p">;</span>
  <span class="nl">direction</span><span class="p">:</span> <span class="nb">ltr</span><span class="p">;</span>
  <span class="nl">-webkit-font-feature-settings</span><span class="p">:</span> <span class="s2">'liga'</span><span class="p">;</span>
  <span class="nl">-webkit-font-smoothing</span><span class="p">:</span> <span class="n">antialiased</span><span class="p">;</span>
<span class="p">}</span>


</code></pre></div></div>

<p>We also download the ttf file and put in <b class="helvetica">www/fonts</b> directory.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir <span class="nt">-p</span> fonts
wget https://fonts.gstatic.com/s/materialicons/v17/2fcrYFNaTjcS6g4U3t-Y5StnKWgpfO2iSkLzTz-AABg.ttf <span class="nt">-O</span> fonts/material_icons.ttf
</code></pre></div></div>

<p>As you can see in the <b class="helvetica">index.html</b>, we add a script named <b class="helvetica">js/main.js</b>: it will be the JavaScript code generated by js_of_ocaml ie our OCaml code compiled in JavaScript.</p>
<h3 id="now-the-best-moment-the-ocaml-code">Now the best moment, the OCaml code!</h3>
<p>The plugin <b class="helvetica">cordova-plugin-sms</b> defines a function <b class="helvetica">Sms.send phonenumber message success_cb error_cb</b> to send a message. The OCaml binding defines a module <b class="helvetica">Cordova_sms</b> and the binding to the Sms.send function <b class="helvetica">send</b> which uses labeled arguments and can be used in this way</p>
<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">Cordova_sms</span><span class="p">.</span><span class="n">send</span> <span class="o">~</span><span class="n">num</span><span class="o">:</span><span class="n">phonenumber</span> <span class="o">~</span><span class="n">msg</span><span class="o">:</span><span class="n">message</span> <span class="o">~</span><span class="n">succ_cb</span><span class="o">:</span><span class="n">success_cb</span> <span class="o">~</span><span class="n">err_cb</span><span class="o">:~</span><span class="n">error_cb</span>
</code></pre></div></div>

<p>Here the logic: the user writes the phonenumber he wants to send the SMS to in the phonenumber input and the SMS content in the message input. When he touched the submit button, we get the contents of these input and call the function <b class="helvetica">Cordova_sms.send</b> with the right arguments.</p>

<p>Here the OCaml code:</p>
<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">on_device_ready</span> <span class="bp">()</span> <span class="o">=</span>
<span class="k">let</span> <span class="n">num_node</span> <span class="o">=</span> <span class="nn">Jsoo_lib</span><span class="p">.</span><span class="n">get_input_by_id</span> <span class="s2">"num"</span> <span class="k">in</span>
<span class="k">let</span> <span class="n">msg_node</span> <span class="o">=</span> <span class="nn">Jsoo_lib</span><span class="p">.</span><span class="n">get_input_by_id</span> <span class="s2">"msg"</span> <span class="k">in</span>
<span class="k">let</span> <span class="n">btn_node</span> <span class="o">=</span> <span class="nn">Jsoo_lib</span><span class="p">.</span><span class="n">get_button_by_id</span> <span class="s2">"submit"</span> <span class="k">in</span>

<span class="k">let</span> <span class="n">succ</span> <span class="bp">()</span> <span class="o">=</span>
<span class="nn">Cordova_dialogs</span><span class="p">.</span><span class="n">alert</span> <span class="s2">"Message sent!"</span> <span class="o">~</span><span class="n">title</span><span class="o">:</span><span class="s2">"It’s working!"</span> <span class="bp">()</span><span class="p">;</span>
<span class="n">num_node</span><span class="o">##.</span><span class="n">value</span> <span class="o">:=</span> <span class="p">(</span><span class="nn">Js</span><span class="p">.</span><span class="n">string</span> <span class="s2">""</span><span class="p">);</span>
<span class="n">msg_node</span><span class="o">##.</span><span class="n">value</span> <span class="o">:=</span> <span class="p">(</span><span class="nn">Js</span><span class="p">.</span><span class="n">string</span> <span class="s2">""</span><span class="p">)</span>
<span class="k">in</span>
<span class="k">let</span> <span class="n">err</span> <span class="n">msg</span> <span class="o">=</span>
<span class="nn">Cordova_dialogs</span><span class="p">.</span><span class="n">alert</span> <span class="n">msg</span> <span class="o">~</span><span class="n">title</span><span class="o">:</span><span class="s2">"Something wrong =(:"</span> <span class="bp">()</span>
<span class="k">in</span>

<span class="n">btn_node</span><span class="o">##.</span><span class="n">onclick</span> <span class="o">:=</span> <span class="nn">Dom</span><span class="p">.</span><span class="n">handler</span>
<span class="p">(</span>
<span class="k">fun</span> <span class="n">e</span> <span class="o">-&gt;</span>
<span class="k">let</span> <span class="n">num</span> <span class="o">=</span> <span class="nn">Js</span><span class="p">.</span><span class="n">to_string</span> <span class="p">(</span><span class="n">num_node</span><span class="o">##.</span><span class="n">value</span><span class="p">)</span> <span class="k">in</span>
<span class="k">let</span> <span class="n">msg</span> <span class="o">=</span> <span class="nn">Js</span><span class="p">.</span><span class="n">to_string</span> <span class="p">(</span><span class="n">msg_node</span><span class="o">##.</span><span class="n">value</span><span class="p">)</span> <span class="k">in</span>
<span class="k">if</span> <span class="n">num</span> <span class="o">=</span> <span class="s2">""</span> <span class="k">then</span>
<span class="nn">Cordova_dialogs</span><span class="p">.</span><span class="n">alert</span> <span class="s2">"Please enter a phone number."</span> <span class="o">~</span><span class="n">title</span><span class="o">:</span><span class="s2">"Missing field"</span> <span class="bp">()</span>
<span class="k">else</span> <span class="k">if</span> <span class="n">msg</span> <span class="o">=</span> <span class="s2">""</span> <span class="k">then</span>
<span class="nn">Cordova_dialogs</span><span class="p">.</span><span class="n">alert</span> <span class="s2">"Please enter a message."</span> <span class="o">~</span><span class="n">title</span><span class="o">:</span><span class="s2">"Missing field"</span> <span class="bp">()</span>
<span class="k">else</span>
<span class="nn">Cordova_sms</span><span class="p">.</span><span class="n">send</span> <span class="o">~</span><span class="n">num</span><span class="o">:</span><span class="n">num</span> <span class="o">~</span><span class="n">msg</span><span class="o">:</span><span class="n">msg</span> <span class="o">~</span><span class="n">succ_cb</span><span class="o">:</span><span class="n">succ</span> <span class="o">~</span><span class="n">err_cb</span><span class="o">:</span><span class="n">err</span> <span class="bp">()</span><span class="p">;</span>
<span class="nn">Js</span><span class="p">.</span><span class="n">_false</span>
<span class="p">)</span>

<span class="k">let</span> <span class="n">_</span> <span class="o">=</span> <span class="nn">Cordova</span><span class="p">.</span><span class="nn">Event</span><span class="p">.</span><span class="n">device_ready</span> <span class="n">on_device_ready</span>
</code></pre></div></div>

<p>Copy and paste this code in a file named <b class="helvetica">test.ml</b></p>
<h3 id="compile-the-ocaml-code-in-javascript">Compile the OCaml code in JavaScript</h3>
<p>It’s time to compile our code in JavaScript. For that, we use js_of_ocaml. As we use some opam package, we will use <b class="helvetica">ocamlfind</b> and the <b class="helvetica">-package</b> argument to link all packages. Js_of_ocaml needs an OCaml bytecode, so first we compile the code in bytecode. Second, we use js_of_ocaml and output the JavaScript in <b class="helvetica">js/main.js</b>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocamlfind ocamlc 
  <span class="nt">-o</span> test.byte <span class="se">\</span>
  <span class="nt">-no-check-prims</span> <span class="se">\</span>
  <span class="nt">-package</span> js_of_ocaml <span class="se">\</span>
  <span class="nt">-package</span> js_of_ocaml.ppx <span class="se">\</span>
  <span class="nt">-package</span> gen_js_api <span class="se">\</span>
  <span class="nt">-package</span> jsoo_lib <span class="se">\</span>
  <span class="nt">-package</span> cordova <span class="se">\</span>
  <span class="nt">-package</span> cordova-plugin-sms <span class="se">\</span>
  <span class="nt">-package</span> cordova-plugin-dialogs <span class="se">\</span>
  <span class="nt">-linkpkg</span> test.ml
js_of_ocaml <span class="nt">-o</span> js/main.js +gen_js_api/ojs_runtime.js test.byte
</code></pre></div></div>
<h3 id="build-the-resulting-application-and-run-it">Build the resulting application and run it</h3>
<p>Now we can build the application. Depending on the platform you want to build for, you use (for Android)</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cordova build android
</code></pre></div></div>
<p>or (for iOS)</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cordova build ios
</code></pre></div></div>

<p>You can finally run the application on the emulator (or on your smartphone if you connected it) by using (for Android)</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cordova run android
</code></pre></div></div>
<p>or (for iOS)</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cordova run ios
</code></pre></div></div>
<h2 id="conclusion">Conclusion</h2>
<p>I hope you liked this tutorial and I invite you to take a deeper look at the <a href="https://github.com/dannywillems/ocaml-cordova-plugin-list">ocaml-cordova-plugin-list</a> repository. You have the entire list of bindings and some examples.</p>

<p>Don’t hesitate to star the project and give a feedback!</p>



  <small>tags: <em>Mobile application</em> - <em>Cordova</em> - <em>OCaml</em> - <em>FP</em></small>


      </section>
    </div>

    
  </body>
</html>


